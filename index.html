<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ISMAEL BARBER</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{
  --black:#0c0c0c;--gray:#6b6b6b;--light:#c8c8c8;--ultra:#f6f6f6;
  --white:#fff;--border:#e8e8e8;--green:#2d6a4f;--red:#8b2020;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{font-family:'DM Sans',sans-serif;background:var(--white);color:var(--black);font-size:14px;overflow-x:hidden;}

/* ‚îÄ‚îÄ BOTTOM NAV (m√≥vil) ‚îÄ‚îÄ */
.bnav{
  display:none;position:fixed;bottom:0;left:0;right:0;
  background:var(--black);z-index:9999;
  display:flex;border-top:1px solid #1a1a1a;
  padding-bottom:env(safe-area-inset-bottom);
}
.bn{
  flex:1;display:flex;flex-direction:column;align-items:center;
  justify-content:center;gap:4px;padding:10px 4px;
  color:#666;font-size:10px;cursor:pointer;
  border:none;background:none;font-family:'DM Sans',sans-serif;
  transition:color .15s;
}
.bn svg{opacity:.5;transition:opacity .15s;}
.bn.active{color:#fff;}
.bn.active svg{opacity:1;}
.bn span{letter-spacing:.03em;}

/* ‚îÄ‚îÄ SIDEBAR (desktop) ‚îÄ‚îÄ */
.sidebar{
  position:fixed;left:0;top:0;bottom:0;width:230px;
  background:var(--black);display:flex;flex-direction:column;
  z-index:100;overflow-y:auto;
}
.logo-area{padding:32px 24px 22px;border-bottom:1px solid #1e1e1e;}
.logo-main{font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:600;color:#fff;letter-spacing:.1em;}
.logo-sub{font-size:9px;color:#555;letter-spacing:.3em;text-transform:uppercase;margin-top:3px;}
.nav-sec{padding:18px 16px 5px;font-size:9px;color:#444;letter-spacing:.22em;text-transform:uppercase;}
.sitem{
  display:flex;align-items:center;gap:11px;padding:12px 14px;
  margin:2px 8px;border-radius:8px;cursor:pointer;color:#777;
  font-size:13px;transition:all .15s;border:none;background:none;
  width:calc(100% - 16px);text-align:left;font-family:'DM Sans',sans-serif;
}
.sitem:hover{background:#181818;color:#bbb;}
.sitem.active{background:#1c1c1c;color:#fff;}
.sitem svg{opacity:.6;flex-shrink:0;}
.sitem.active svg{opacity:1;}
.sfooter{padding:14px 18px;border-top:1px solid #1e1e1e;margin-top:auto;}
.sfooter-lbl{font-size:9px;color:#444;letter-spacing:.1em;text-transform:uppercase;}
.sfooter-val{font-size:11px;color:#2d6a4f;margin-top:3px;}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main{margin-left:230px;padding:36px 40px;min-height:100vh;padding-bottom:30px;}
.page{display:none;}
.page.active{display:block;animation:fi .2s ease;}
@keyframes fi{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}

/* ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ */
.ph{display:flex;align-items:flex-end;justify-content:space-between;margin-bottom:28px;padding-bottom:20px;border-bottom:1px solid var(--border);gap:14px;flex-wrap:wrap;}
.ptitle{font-family:'Cormorant Garamond',serif;font-size:32px;font-weight:500;letter-spacing:.02em;}
.psub{font-size:12px;color:var(--gray);margin-top:3px;}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{display:inline-flex;align-items:center;gap:7px;padding:10px 18px;border-radius:7px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:500;cursor:pointer;border:none;transition:all .15s;white-space:nowrap;}
.btn-p{background:var(--black);color:#fff;}
.btn-p:hover,.btn-p:active{background:#333;}
.btn-o{background:transparent;color:var(--black);border:1px solid var(--border);}
.btn-o:hover{border-color:#aaa;}
.btn-x{background:none;border:1px solid #f0d0d0;color:var(--red);padding:5px 10px;font-size:11px;border-radius:5px;cursor:pointer;font-family:'DM Sans',sans-serif;}

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
.sg{display:grid;gap:14px;margin-bottom:26px;}
.s3{grid-template-columns:repeat(3,1fr);}
.s4{grid-template-columns:repeat(4,1fr);}
.sc{padding:20px;border:1px solid var(--border);border-radius:10px;}
.slbl{font-size:10px;color:var(--gray);letter-spacing:.14em;text-transform:uppercase;margin-bottom:9px;}
.sval{font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:500;line-height:1;}
.snote{font-size:11px;color:var(--gray);margin-top:5px;}
.sup{color:var(--green);}.sdn{color:var(--red);}
.apos{color:var(--green);font-weight:500;}.aneg{color:var(--red);font-weight:500;}

/* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
.tw{border:1px solid var(--border);border-radius:10px;overflow:hidden;overflow-x:auto;margin-bottom:18px;}
table{width:100%;border-collapse:collapse;min-width:440px;}
thead th{background:var(--ultra);padding:11px 15px;text-align:left;font-size:10px;font-weight:500;color:var(--gray);letter-spacing:.12em;text-transform:uppercase;border-bottom:1px solid var(--border);white-space:nowrap;}
tbody tr{border-bottom:1px solid var(--border);}
tbody tr:last-child{border-bottom:none;}
tbody tr:hover{background:#fafafa;}
td{padding:12px 15px;font-size:13px;color:#2a2a2a;vertical-align:middle;}
.tr-tot td{font-weight:600;background:var(--ultra);border-top:1px solid var(--border);}
.tag{display:inline-block;padding:3px 9px;border-radius:20px;font-size:11px;}
.tsvc{background:#f0f0f0;color:#333;}
.tnew{background:#e8f4ee;color:var(--green);}

/* ‚îÄ‚îÄ CLIENT CARDS ‚îÄ‚îÄ */
.cg{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:14px;}
.cc{border:1px solid var(--border);border-radius:10px;overflow:hidden;transition:box-shadow .2s,transform .2s;}
.cc:hover{box-shadow:0 4px 16px rgba(0,0,0,.07);transform:translateY(-2px);}
.cc-img{width:100%;height:100px;background:var(--ultra);display:flex;align-items:center;justify-content:center;font-size:32px;overflow:hidden;}
.cc-img img{width:100%;height:100%;object-fit:cover;}
.cc-body{padding:14px;}
.cc-name{font-family:'Cormorant Garamond',serif;font-size:17px;font-weight:600;margin-bottom:2px;}
.cc-phone{font-size:12px;color:var(--gray);margin-bottom:7px;}
.cc-ficha{font-size:12px;color:var(--gray);margin-bottom:9px;line-height:1.5;}
.cc-foot{display:flex;justify-content:space-between;align-items:center;font-size:11px;color:var(--gray);border-top:1px solid var(--border);padding-top:9px;}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.mo{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:99999;align-items:center;justify-content:center;padding:16px;}
.mo.open{display:flex;}
.md{background:#fff;border-radius:14px;padding:26px;width:100%;max-width:480px;max-height:92vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.15);}
.md-title{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:500;margin-bottom:20px;}
.fg{margin-bottom:14px;}
label{display:block;font-size:10px;font-weight:500;color:var(--gray);letter-spacing:.12em;text-transform:uppercase;margin-bottom:5px;}
input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:6px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--black);background:#fff;outline:none;transition:border-color .15s;-webkit-appearance:none;appearance:none;}
input:focus,select:focus,textarea:focus{border-color:var(--black);}
textarea{min-height:68px;resize:vertical;}
.fr{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.ma{display:flex;gap:10px;justify-content:flex-end;margin-top:18px;padding-top:16px;border-top:1px solid var(--border);}

/* ‚îÄ‚îÄ CHARTS ‚îÄ‚îÄ */
.cgrid{display:grid;grid-template-columns:2fr 1fr;gap:18px;margin-bottom:22px;}
.chcard{border:1px solid var(--border);border-radius:10px;padding:22px;}
.chtitle{font-size:10px;font-weight:500;color:var(--gray);margin-bottom:16px;letter-spacing:.12em;text-transform:uppercase;}
.barchart{display:flex;align-items:flex-end;gap:4px;height:130px;}
.bcol{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;height:100%;justify-content:flex-end;}
.bval{font-size:8px;color:var(--gray);}
.binn{display:flex;gap:2px;align-items:flex-end;height:100px;}
.bar{border-radius:3px 3px 0 0;min-height:2px;}
.bi{background:var(--black);width:10px;}
.bg{background:var(--light);width:10px;}
.blbl{font-size:8px;color:var(--gray);}
.dwrap{display:flex;flex-direction:column;align-items:center;gap:14px;}
.dleg{display:flex;flex-direction:column;gap:7px;}
.dli{display:flex;align-items:center;gap:7px;font-size:12px;}
.dldot{width:9px;height:9px;border-radius:50%;flex-shrink:0;}

/* ‚îÄ‚îÄ KANBAN ‚îÄ‚îÄ */
.kb{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;}
.kc{background:var(--ultra);border-radius:10px;padding:14px;}
.kch{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.kct{font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:#2a2a2a;}
.kcc{font-size:11px;background:#fff;border:1px solid var(--border);color:var(--gray);padding:2px 8px;border-radius:20px;}
.kcard{background:#fff;border:1px solid var(--border);border-radius:8px;padding:12px 13px;margin-bottom:8px;transition:box-shadow .15s;}
.kcard:hover{box-shadow:0 3px 10px rgba(0,0,0,.07);}
.kct2{font-size:13px;font-weight:500;margin-bottom:5px;}
.kcm{font-size:11px;color:var(--gray);display:flex;gap:7px;flex-wrap:wrap;margin-bottom:7px;}
.ptag{padding:2px 7px;border-radius:3px;font-size:10px;font-weight:600;}
.tig{background:#f0e8f5;color:#6a1a8a;}
.ttt{background:#e8f0f5;color:#1a4a8a;}
.tbo{background:#fff0e8;color:#8a3a1a;}
.kact{display:flex;gap:4px;flex-wrap:wrap;margin-top:5px;}
.kmv{font-size:10px;padding:3px 7px;border:1px solid var(--border);border-radius:4px;cursor:pointer;background:#fff;color:var(--gray);font-family:'DM Sans',sans-serif;}
.kmv:hover{border-color:var(--black);color:var(--black);}

/* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
.sw{display:flex;align-items:center;gap:7px;border:1px solid var(--border);border-radius:7px;padding:8px 12px;}
.sw input{border:none;padding:0;font-size:13px;width:165px;}
.sw input:focus{outline:none;}

/* ‚îÄ‚îÄ MONTH FILTER ‚îÄ‚îÄ */
.mf{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:20px;}
.mb{padding:5px 12px;border-radius:20px;font-size:12px;cursor:pointer;border:1px solid var(--border);background:#fff;color:var(--gray);font-family:'DM Sans',sans-serif;transition:all .1s;}
.mb:hover,.mb.active{background:var(--black);color:#fff;border-color:var(--black);}

/* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
.empty{text-align:center;padding:44px 20px;color:var(--gray);}
.empty svg{opacity:.2;margin-bottom:12px;}
.empty p{font-size:13px;}

/* ‚îÄ‚îÄ NOTIF ‚îÄ‚îÄ */
.notif{position:fixed;bottom:80px;right:20px;background:var(--black);color:#fff;padding:12px 18px;border-radius:8px;font-size:13px;z-index:999999;transform:translateY(70px);opacity:0;transition:all .3s;pointer-events:none;max-width:calc(100vw - 40px);}
.notif.show{transform:translateY(0);opacity:1;}
.notif.err{background:var(--red);}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:900px){
  .sidebar{display:none;}
  .main{margin-left:0;padding:20px 15px 90px;}
  .bnav{display:flex;}
  .s3,.s4{grid-template-columns:repeat(2,1fr);}
  .cgrid{grid-template-columns:1fr;}
  .kb{grid-template-columns:1fr;}
  .fr{grid-template-columns:1fr;}
  .ph{flex-direction:column;align-items:flex-start;}
  .cg{grid-template-columns:repeat(2,1fr);}
  .ptitle{font-size:26px;}
  .notif{bottom:90px;}
}
@media(max-width:520px){
  .s3,.s4{grid-template-columns:1fr 1fr;}
  .cg{grid-template-columns:1fr;}
  .md{padding:20px 15px;}
  .sval{font-size:24px;}
}
@media(min-width:901px){
  .bnav{display:none;}
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê BOTTOM NAV (m√≥vil) ‚ïê‚ïê‚ïê -->
<nav class="bnav">
  <button class="bn active" id="bn-crm" onclick="showPage('crm','crm')">
    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
    <span>Clientes</span>
  </button>
  <button class="bn" id="bn-agenda" onclick="showPage('agenda','agenda')">
    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
    <span>Agenda</span>
  </button>
  <button class="bn" id="bn-gastos" onclick="showPage('gastos','gastos')">
    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
    <span>Gastos</span>
  </button>
  <button class="bn" id="bn-balance" onclick="showPage('balance','balance')">
    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
    <span>Balance</span>
  </button>
  <button class="bn" id="bn-contenido" onclick="showPage('contenido','contenido')">
    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
    <span>Contenido</span>
  </button>
</nav>

<!-- ‚ïê‚ïê‚ïê SIDEBAR (desktop) ‚ïê‚ïê‚ïê -->
<aside class="sidebar">
  <div class="logo-area">
    <div class="logo-main">ISMAEL</div>
    <div class="logo-sub">Barber Studio</div>
  </div>
  <div class="nav-sec">Principal</div>
  <button class="sitem active" id="s-crm" onclick="showPage('crm','crm')">
    <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
    Clientes (CRM)
  </button>
  <button class="sitem" id="s-agenda" onclick="showPage('agenda','agenda')">
    <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
    Agenda & Citas
  </button>
  <button class="sitem" id="s-gastos" onclick="showPage('gastos','gastos')">
    <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
    Control de Gastos
  </button>
  <button class="sitem" id="s-balance" onclick="showPage('balance','balance')">
    <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
    Balance & Gr√°ficas
  </button>
  <div class="nav-sec">Marketing</div>
  <button class="sitem" id="s-contenido" onclick="showPage('contenido','contenido')">
    <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
    Creaci√≥n de Contenido
  </button>
  <div class="sfooter">
    <div class="sfooter-lbl">Almacenamiento</div>
    <div class="sfooter-val" id="storeStatus">‚óè Activo</div>
  </div>
</aside>

<!-- ‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê -->
<main class="main">

  <!-- CRM -->
  <div class="page active" id="page-crm">
    <div class="ph">
      <div><div class="ptitle">Clientes</div><div class="psub">Fichas t√©cnicas y galer√≠a</div></div>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
        <div class="sw">
          <svg width="13" height="13" fill="none" stroke="#bbb" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input type="text" placeholder="Buscar..." id="searchInput" oninput="filterClients()">
        </div>
        <button class="btn btn-p" onclick="openModal('mCliente')">
          <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          Nuevo Cliente
        </button>
      </div>
    </div>
    <div class="sg s3">
      <div class="sc"><div class="slbl">Total Clientes</div><div class="sval" id="sTotal">0</div><div class="snote">registrados</div></div>
      <div class="sc"><div class="slbl">Nuevos este mes</div><div class="sval" id="sNuevos">0</div><div class="snote sup">activos</div></div>
      <div class="sc"><div class="slbl">Recurrentes</div><div class="sval" id="sRecur">0</div><div class="snote">fidelizados</div></div>
    </div>
    <div class="cg" id="clientsGrid">
      <div class="empty" style="grid-column:1/-1"><svg width="40" height="40" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg><p>A√∫n no hay clientes ‚Äî ¬°a√±ade el primero!</p></div>
    </div>
  </div>

  <!-- AGENDA -->
  <div class="page" id="page-agenda">
    <div class="ph">
      <div><div class="ptitle">Agenda & Citas</div><div class="psub">Ingresos por servicio</div></div>
      <button class="btn btn-p" onclick="openModal('mCita')">
        <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Nueva Cita
      </button>
    </div>
    <div class="mf" id="mfAgenda"></div>
    <div class="sg s3">
      <div class="sc"><div class="slbl">Facturaci√≥n Mes</div><div class="sval" id="aS1">0‚Ç¨</div><div class="snote sup" id="aS1b">0 citas</div></div>
      <div class="sc"><div class="slbl">Ticket Medio</div><div class="sval" id="aS2">0‚Ç¨</div><div class="snote">por cita</div></div>
      <div class="sc"><div class="slbl">Servicio Top</div><div class="sval" style="font-size:16px" id="aS3">‚Äî</div><div class="snote">m√°s solicitado</div></div>
    </div>
    <div class="tw">
      <table>
        <thead><tr><th>Fecha</th><th>Hora</th><th>Cliente</th><th>Servicio</th><th>Precio</th><th>Notas</th><th></th></tr></thead>
        <tbody id="citasBody"><tr><td colspan="7"><div class="empty"><p>Sin citas este mes</p></div></td></tr></tbody>
        <tfoot><tr class="tr-tot"><td colspan="4"><strong>TOTAL DEL MES</strong></td><td colspan="3"><strong id="totalMes">0 ‚Ç¨</strong></td></tr></tfoot>
      </table>
    </div>
  </div>

  <!-- GASTOS -->
  <div class="page" id="page-gastos">
    <div class="ph">
      <div><div class="ptitle">Control de Gastos</div><div class="psub">Productos, herramientas y suministros</div></div>
      <button class="btn btn-p" onclick="openModal('mGasto')">
        <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Registrar Gasto
      </button>
    </div>
    <div class="mf" id="mfGastos"></div>
    <div class="sg s3">
      <div class="sc"><div class="slbl">Gastos del Mes</div><div class="sval aneg" id="gS1">0‚Ç¨</div><div class="snote sdn" id="gS1b">0 registros</div></div>
      <div class="sc"><div class="slbl">Categor√≠a Mayor</div><div class="sval" style="font-size:16px" id="gS2">‚Äî</div><div class="snote">m√°s gasto</div></div>
      <div class="sc"><div class="slbl">Gasto Medio</div><div class="sval" id="gS3">0‚Ç¨</div><div class="snote">por registro</div></div>
    </div>
    <div class="tw">
      <table>
        <thead><tr><th>Fecha</th><th>Descripci√≥n</th><th>Categor√≠a</th><th>Importe</th><th></th></tr></thead>
        <tbody id="gastosBody"><tr><td colspan="5"><div class="empty"><p>Sin gastos este mes</p></div></td></tr></tbody>
        <tfoot><tr class="tr-tot"><td colspan="3"><strong>TOTAL GASTOS</strong></td><td colspan="2"><strong class="aneg" id="totalGastos">0 ‚Ç¨</strong></td></tr></tfoot>
      </table>
    </div>
  </div>

  <!-- BALANCE -->
  <div class="page" id="page-balance">
    <div class="ph"><div><div class="ptitle">Balance & Beneficios</div><div class="psub">Visi√≥n financiera completa</div></div></div>
    <div class="sg s4">
      <div class="sc"><div class="slbl">Ingresos Totales</div><div class="sval apos" id="bS1">0‚Ç¨</div><div class="snote">acumulado</div></div>
      <div class="sc"><div class="slbl">Gastos Totales</div><div class="sval aneg" id="bS2">0‚Ç¨</div><div class="snote">acumulado</div></div>
      <div class="sc"><div class="slbl">Beneficio Neto</div><div class="sval" id="bS3">0‚Ç¨</div><div class="snote" id="bS3n">real</div></div>
      <div class="sc"><div class="slbl">Margen</div><div class="sval" id="bS4">‚Äî%</div><div class="snote">sobre ingresos</div></div>
    </div>
    <div class="cgrid">
      <div class="chcard">
        <div class="chtitle">Facturaci√≥n vs Gastos por mes</div>
        <div class="barchart" id="barChart"></div>
        <div style="display:flex;gap:14px;margin-top:12px;">
          <div style="display:flex;align-items:center;gap:5px;font-size:11px;color:var(--gray)"><div style="width:10px;height:10px;background:var(--black);border-radius:2px"></div>Ingresos</div>
          <div style="display:flex;align-items:center;gap:5px;font-size:11px;color:var(--gray)"><div style="width:10px;height:10px;background:var(--light);border-radius:2px"></div>Gastos</div>
        </div>
      </div>
      <div class="chcard">
        <div class="chtitle">Nuevos vs Recurrentes</div>
        <div class="dwrap" id="donutChart"></div>
      </div>
    </div>
    <div class="chcard" style="margin-bottom:24px">
      <div class="chtitle">Clientes nuevos por mes</div>
      <div class="barchart" id="clientChart"></div>
    </div>
  </div>

  <!-- CONTENIDO -->
  <div class="page" id="page-contenido">
    <div class="ph">
      <div><div class="ptitle">Creaci√≥n de Contenido</div><div class="psub">Planificaci√≥n Instagram & TikTok</div></div>
      <button class="btn btn-p" onclick="openModal('mPost')">
        <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Nueva Idea
      </button>
    </div>
    <div class="kb">
      <div class="kc"><div class="kch"><div class="kct">üí° Ideas</div><span class="kcc" id="cnt-ideas">0</span></div><div id="col-ideas"></div></div>
      <div class="kc"><div class="kch"><div class="kct">üé¨ En Producci√≥n</div><span class="kcc" id="cnt-produccion">0</span></div><div id="col-produccion"></div></div>
      <div class="kc"><div class="kch"><div class="kct">‚úÖ Publicado</div><span class="kcc" id="cnt-publicado">0</span></div><div id="col-publicado"></div></div>
    </div>
  </div>

</main>

<!-- ‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê -->
<div class="mo" id="mCliente">
  <div class="md">
    <div class="md-title">Nuevo Cliente</div>
    <div class="fg"><label>Nombre *</label><input type="text" id="c_nom" placeholder="Ej. Carlos Garc√≠a"></div>
    <div class="fr">
      <div class="fg"><label>Tel√©fono</label><input type="tel" id="c_tel" placeholder="+34 600 000 000"></div>
      <div class="fg"><label>¬øEs nuevo?</label><select id="c_nvo"><option value="true">S√≠, nuevo</option><option value="false">Recurrente</option></select></div>
    </div>
    <div class="fg"><label>Fecha √∫ltima visita</label><input type="date" id="c_fec"></div>
    <div class="fg"><label>Ficha t√©cnica</label><textarea id="c_fic" placeholder="Corte, estilo, productos preferidos..."></textarea></div>
    <div class="fg"><label>URL foto del corte (opcional)</label><input type="text" id="c_fot" placeholder="https://..."></div>
    <div class="ma">
      <button class="btn btn-o" onclick="closeModal('mCliente')">Cancelar</button>
      <button class="btn btn-p" onclick="saveCliente()">Guardar</button>
    </div>
  </div>
</div>

<div class="mo" id="mCita">
  <div class="md">
    <div class="md-title">Nueva Cita</div>
    <div class="fr">
      <div class="fg"><label>Fecha *</label><input type="date" id="ci_fec"></div>
      <div class="fg"><label>Hora</label><input type="time" id="ci_hor" value="10:00"></div>
    </div>
    <div class="fg"><label>Cliente</label><select id="ci_cli"></select></div>
    <div class="fr">
      <div class="fg"><label>Servicio</label>
        <select id="ci_svc"><option>Corte de pelo</option><option>Corte + Barba</option><option>Barba</option><option>Afeitado cl√°sico</option><option>Tratamiento capilar</option><option>Coloraci√≥n</option><option>Paquete completo</option><option>Otro</option></select>
      </div>
      <div class="fg"><label>Precio (‚Ç¨) *</label><input type="number" id="ci_pre" placeholder="0.00" min="0" step="0.5"></div>
    </div>
    <div class="fg"><label>Notas</label><input type="text" id="ci_not" placeholder="Observaciones..."></div>
    <div class="ma">
      <button class="btn btn-o" onclick="closeModal('mCita')">Cancelar</button>
      <button class="btn btn-p" onclick="saveCita()">Guardar</button>
    </div>
  </div>
</div>

<div class="mo" id="mGasto">
  <div class="md">
    <div class="md-title">Registrar Gasto</div>
    <div class="fg"><label>Descripci√≥n *</label><input type="text" id="g_dsc" placeholder="Ej. M√°quina Wahl, aceite de barba..."></div>
    <div class="fr">
      <div class="fg"><label>Categor√≠a</label>
        <select id="g_cat"><option>Productos</option><option>Herramientas</option><option>Material fungible</option><option>Alquiler / Local</option><option>Publicidad</option><option>Formaci√≥n</option><option>Otros</option></select>
      </div>
      <div class="fg"><label>Importe (‚Ç¨) *</label><input type="number" id="g_imp" placeholder="0.00" min="0" step="0.01"></div>
    </div>
    <div class="fg"><label>Fecha *</label><input type="date" id="g_fec"></div>
    <div class="ma">
      <button class="btn btn-o" onclick="closeModal('mGasto')">Cancelar</button>
      <button class="btn btn-p" onclick="saveGasto()">Guardar</button>
    </div>
  </div>
</div>

<div class="mo" id="mPost">
  <div class="md">
    <div class="md-title">Nueva Idea de Contenido</div>
    <div class="fg"><label>T√≠tulo *</label><input type="text" id="p_tit" placeholder="Ej. Tutorial fade paso a paso"></div>
    <div class="fr">
      <div class="fg"><label>Plataforma</label>
        <select id="p_pla"><option>Instagram</option><option>TikTok</option><option>Instagram + TikTok</option><option>Instagram Reels</option></select>
      </div>
      <div class="fg"><label>Tipo</label>
        <select id="p_tip"><option>V√≠deo / Reel</option><option>Foto</option><option>Carrusel</option><option>Stories</option><option>Live</option></select>
      </div>
    </div>
    <div class="fg"><label>Descripci√≥n / Gui√≥n</label><textarea id="p_dsc" placeholder="Gui√≥n, hashtags, gancho..."></textarea></div>
    <div class="fg"><label>Estado</label>
      <select id="p_est"><option value="ideas">üí° Idea</option><option value="produccion">üé¨ En Producci√≥n</option><option value="publicado">‚úÖ Publicado</option></select>
    </div>
    <div class="ma">
      <button class="btn btn-o" onclick="closeModal('mPost')">Cancelar</button>
      <button class="btn btn-p" onclick="savePost()">Guardar</button>
    </div>
  </div>
</div>

<div class="notif" id="notif"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STORAGE ‚Äî guarda en el navegador
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DB = {
  get(k){ try{ return JSON.parse(localStorage.getItem('ib_'+k)||'[]'); }catch(e){ return []; } },
  set(k,v){ try{ localStorage.setItem('ib_'+k, JSON.stringify(v)); return true; }catch(e){ return false; } }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let clientes = DB.get('clientes');
let citas    = DB.get('citas');
let gastos   = DB.get('gastos');
let posts    = DB.get('posts');
let agendaMes = new Date().getMonth();
let gastosMes = new Date().getMonth();
const YEAR = new Date().getFullYear();
const MM = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];

function persist() {
  DB.set('clientes', clientes);
  DB.set('citas', citas);
  DB.set('gastos', gastos);
  DB.set('posts', posts);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showPage(pageId, navId) {
  // Pages
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + pageId).classList.add('active');

  // Sidebar (desktop)
  document.querySelectorAll('.sitem').forEach(n => n.classList.remove('active'));
  const si = document.getElementById('s-' + navId);
  if (si) si.classList.add('active');

  // Bottom nav (m√≥vil)
  document.querySelectorAll('.bn').forEach(n => n.classList.remove('active'));
  const bn = document.getElementById('bn-' + navId);
  if (bn) bn.classList.add('active');

  renderAll();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(id) {
  const today = new Date().toISOString().split('T')[0];
  if (id === 'mCliente') document.getElementById('c_fec').value = today;
  if (id === 'mGasto')   document.getElementById('g_fec').value = today;
  if (id === 'mCita') {
    document.getElementById('ci_fec').value = today;
    const sel = document.getElementById('ci_cli');
    sel.innerHTML = clientes.length
      ? clientes.map(c => `<option value="${c.id}">${c.nombre}</option>`).join('')
      : '<option>A√±ade clientes primero</option>';
  }
  document.getElementById(id).classList.add('open');
}
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.mo').forEach(o => {
  o.addEventListener('click', e => { if (e.target === o) o.classList.remove('open'); });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTIFY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let nt;
function notify(msg, isErr=false) {
  const n = document.getElementById('notif');
  n.textContent = msg;
  n.className = 'notif' + (isErr ? ' err' : '') + ' show';
  clearTimeout(nt);
  nt = setTimeout(() => n.classList.remove('show'), 2800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MONTH FILTER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildMF(cid, sel, cb) {
  document.getElementById(cid).innerHTML = MM.map((m,i) =>
    `<div class="mb${i===sel?' active':''}" onclick="(${cb.toString()})(${i},this)">${m}</div>`
  ).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CRM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveCliente() {
  const nom = document.getElementById('c_nom').value.trim();
  if (!nom) { notify('Introduce un nombre', true); return; }
  clientes.push({
    id: Date.now(),
    nombre: nom,
    telefono: document.getElementById('c_tel').value,
    es_nuevo: document.getElementById('c_nvo').value === 'true',
    fecha_ultima_visita: document.getElementById('c_fec').value || null,
    ficha_tecnica: document.getElementById('c_fic').value,
    foto_url: document.getElementById('c_fot').value
  });
  persist();
  ['c_nom','c_tel','c_fic','c_fot'].forEach(id => document.getElementById(id).value = '');
  closeModal('mCliente');
  renderClients();
  notify('‚úì Cliente guardado');
}
function deleteCliente(id) {
  if (!confirm('¬øEliminar este cliente?')) return;
  clientes = clientes.filter(c => c.id !== id);
  persist(); renderClients(); notify('Cliente eliminado');
}
function filterClients() { renderClients(document.getElementById('searchInput').value); }
function renderClients(filter='') {
  const fl = clientes.filter(c => c.nombre.toLowerCase().includes(filter.toLowerCase()));
  const tm = new Date().getMonth();
  document.getElementById('sTotal').textContent = clientes.length;
  document.getElementById('sNuevos').textContent = clientes.filter(c =>
    c.fecha_ultima_visita && new Date(c.fecha_ultima_visita).getMonth()===tm && c.es_nuevo
  ).length;
  document.getElementById('sRecur').textContent = clientes.filter(c => !c.es_nuevo).length;

  const grid = document.getElementById('clientsGrid');
  if (!fl.length) {
    grid.innerHTML = `<div class="empty" style="grid-column:1/-1">
      <svg width="40" height="40" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
      <p>${filter ? 'Sin resultados para "'+filter+'"' : 'A√∫n no hay clientes ‚Äî ¬°a√±ade el primero!'}</p></div>`;
    return;
  }
  grid.innerHTML = fl.map(c => `
    <div class="cc">
      <div class="cc-img">${c.foto_url ? `<img src="${c.foto_url}" onerror="this.parentNode.innerHTML='‚úÇÔ∏è'">` : '‚úÇÔ∏è'}</div>
      <div class="cc-body">
        <div class="cc-name">${c.nombre}</div>
        <div class="cc-phone">${c.telefono||'‚Äî'}</div>
        <div class="cc-ficha">${c.ficha_tecnica ? c.ficha_tecnica.substring(0,65)+(c.ficha_tecnica.length>65?'‚Ä¶':'') : 'Sin ficha t√©cnica'}</div>
        <div class="cc-foot">
          <span>√öltima: ${c.fecha_ultima_visita||'‚Äî'}</span>
          <div style="display:flex;align-items:center;gap:6px;">
            ${c.es_nuevo ? '<span class="tag tnew">Nuevo</span>' : ''}
            <button class="btn-x" onclick="deleteCliente(${c.id})">√ó</button>
          </div>
        </div>
      </div>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AGENDA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveCita() {
  const fecha = document.getElementById('ci_fec').value;
  if (!fecha) { notify('Selecciona una fecha', true); return; }
  const cEl = document.getElementById('ci_cli');
  citas.push({
    id: Date.now(),
    fecha,
    hora: document.getElementById('ci_hor').value || null,
    clienteId: parseInt(cEl.value) || null,
    clienteNombre: cEl.selectedOptions[0]?.text || '‚Äî',
    servicio: document.getElementById('ci_svc').value,
    precio: parseFloat(document.getElementById('ci_pre').value) || 0,
    notas: document.getElementById('ci_not').value
  });
  persist();
  document.getElementById('ci_not').value = '';
  document.getElementById('ci_pre').value = '';
  closeModal('mCita'); renderAgenda(); notify('‚úì Cita guardada');
}
function deleteCita(id) {
  if (!confirm('¬øEliminar esta cita?')) return;
  citas = citas.filter(c => c.id !== id);
  persist(); renderAgenda(); notify('Cita eliminada');
}
function renderAgenda() {
  buildMF('mfAgenda', agendaMes, (m,el)=>{
    agendaMes=m;
    document.querySelectorAll('#mfAgenda .mb').forEach(b=>b.classList.remove('active'));
    el.classList.add('active'); renderAgenda();
  });
  const fl = citas.filter(c=>{const d=new Date(c.fecha);return d.getMonth()===agendaMes&&d.getFullYear()===YEAR;})
    .sort((a,b)=>new Date(a.fecha+'T'+(a.hora||'00:00'))-new Date(b.fecha+'T'+(b.hora||'00:00')));
  const total = fl.reduce((s,c)=>s+(parseFloat(c.precio)||0),0);
  const avg = fl.length?total/fl.length:0;
  const svc={}; fl.forEach(c=>svc[c.servicio]=(svc[c.servicio]||0)+1);
  const top = Object.entries(svc).sort((a,b)=>b[1]-a[1])[0];
  document.getElementById('aS1').textContent=total.toFixed(0)+'‚Ç¨';
  document.getElementById('aS1b').textContent=fl.length+' citas';
  document.getElementById('aS2').textContent=avg.toFixed(0)+'‚Ç¨';
  document.getElementById('aS3').textContent=top?top[0]:'‚Äî';
  document.getElementById('totalMes').textContent=total.toFixed(2)+' ‚Ç¨';
  const tb = document.getElementById('citasBody');
  if (!fl.length){tb.innerHTML=`<tr><td colspan="7"><div class="empty"><p>Sin citas en ${MM[agendaMes]}</p></div></td></tr>`;return;}
  tb.innerHTML=fl.map(c=>`<tr>
    <td>${c.fecha}</td><td>${c.hora||'‚Äî'}</td><td>${c.clienteNombre||'‚Äî'}</td>
    <td><span class="tag tsvc">${c.servicio}</span></td>
    <td><strong>${parseFloat(c.precio||0).toFixed(2)} ‚Ç¨</strong></td>
    <td style="color:var(--gray);max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${c.notas||''}</td>
    <td><button class="btn-x" onclick="deleteCita(${c.id})">Eliminar</button></td>
  </tr>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GASTOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveGasto() {
  const dsc = document.getElementById('g_dsc').value.trim();
  const fec = document.getElementById('g_fec').value;
  if (!dsc||!fec){notify('Completa los campos obligatorios',true);return;}
  gastos.push({
    id:Date.now(), descripcion:dsc,
    categoria:document.getElementById('g_cat').value,
    importe:parseFloat(document.getElementById('g_imp').value)||0, fecha:fec
  });
  persist();
  document.getElementById('g_dsc').value=''; document.getElementById('g_imp').value='';
  closeModal('mGasto'); renderGastos(); notify('‚úì Gasto registrado');
}
function deleteGasto(id) {
  if(!confirm('¬øEliminar este gasto?')) return;
  gastos=gastos.filter(g=>g.id!==id);
  persist(); renderGastos(); notify('Gasto eliminado');
}
function renderGastos() {
  buildMF('mfGastos', gastosMes, (m,el)=>{
    gastosMes=m;
    document.querySelectorAll('#mfGastos .mb').forEach(b=>b.classList.remove('active'));
    el.classList.add('active'); renderGastos();
  });
  const fl=gastos.filter(g=>{const d=new Date(g.fecha);return d.getMonth()===gastosMes&&d.getFullYear()===YEAR;})
    .sort((a,b)=>new Date(b.fecha)-new Date(a.fecha));
  const total=fl.reduce((s,g)=>s+(parseFloat(g.importe)||0),0);
  const avg=fl.length?total/fl.length:0;
  const cats={}; fl.forEach(g=>cats[g.categoria]=(cats[g.categoria]||0)+(parseFloat(g.importe)||0));
  const topC=Object.entries(cats).sort((a,b)=>b[1]-a[1])[0];
  document.getElementById('gS1').textContent=total.toFixed(0)+'‚Ç¨';
  document.getElementById('gS1b').textContent=fl.length+' registros';
  document.getElementById('gS2').textContent=topC?topC[0]:'‚Äî';
  document.getElementById('gS3').textContent=avg.toFixed(0)+'‚Ç¨';
  document.getElementById('totalGastos').textContent=total.toFixed(2)+' ‚Ç¨';
  const tb=document.getElementById('gastosBody');
  if(!fl.length){tb.innerHTML=`<tr><td colspan="5"><div class="empty"><p>Sin gastos en ${MM[gastosMes]}</p></div></td></tr>`;return;}
  tb.innerHTML=fl.map(g=>`<tr>
    <td>${g.fecha}</td><td>${g.descripcion}</td>
    <td><span class="tag tsvc">${g.categoria}</span></td>
    <td class="aneg"><strong>${parseFloat(g.importe||0).toFixed(2)} ‚Ç¨</strong></td>
    <td><button class="btn-x" onclick="deleteGasto(${g.id})">Eliminar</button></td>
  </tr>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BALANCE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderBalance() {
  const ing=citas.reduce((s,c)=>s+(parseFloat(c.precio)||0),0);
  const gas=gastos.reduce((s,g)=>s+(parseFloat(g.importe)||0),0);
  const neto=ing-gas;
  const margen=ing?((neto/ing)*100).toFixed(1):0;
  document.getElementById('bS1').textContent=ing.toFixed(0)+'‚Ç¨';
  document.getElementById('bS2').textContent=gas.toFixed(0)+'‚Ç¨';
  const nEl=document.getElementById('bS3');
  nEl.textContent=(neto>=0?'+':'')+neto.toFixed(0)+'‚Ç¨';
  nEl.className='sval '+(neto>=0?'apos':'aneg');
  document.getElementById('bS3n').textContent=neto>=0?'beneficio real ‚úì':'p√©rdida ‚ö†';
  document.getElementById('bS4').textContent=margen+'%';

  const mData=MM.map((m,i)=>({
    m,
    ing:citas.filter(c=>new Date(c.fecha).getMonth()===i&&new Date(c.fecha).getFullYear()===YEAR).reduce((s,c)=>s+(parseFloat(c.precio)||0),0),
    gas:gastos.filter(g=>new Date(g.fecha).getMonth()===i&&new Date(g.fecha).getFullYear()===YEAR).reduce((s,g)=>s+(parseFloat(g.importe)||0),0)
  }));
  const maxV=Math.max(...mData.map(d=>Math.max(d.ing,d.gas)),1);
  document.getElementById('barChart').innerHTML=mData.map(d=>`
    <div class="bcol">
      <div class="bval">${d.ing>0?d.ing.toFixed(0):''}</div>
      <div class="binn">
        <div class="bar bi" style="height:${Math.max((d.ing/maxV)*100,d.ing>0?3:0)}%" title="${d.ing.toFixed(2)}‚Ç¨ ingresos"></div>
        <div class="bar bg" style="height:${Math.max((d.gas/maxV)*100,d.gas>0?3:0)}%" title="${d.gas.toFixed(2)}‚Ç¨ gastos"></div>
      </div>
      <div class="blbl">${d.m}</div>
    </div>`).join('');

  const tot=clientes.length,nv=clientes.filter(c=>c.es_nuevo).length,rc=tot-nv;
  const r=55,cx=75,cy=75,circ=2*Math.PI*r,pN=tot?(nv/tot):0.5,dN=pN*circ;
  document.getElementById('donutChart').innerHTML=`
    <svg width="150" height="150" viewBox="0 0 150 150">
      <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="#f0f0f0" stroke-width="16"/>
      <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="var(--black)" stroke-width="16"
        stroke-dasharray="${dN} ${circ-dN}" stroke-dashoffset="${circ/4}" stroke-linecap="round"/>
      <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="var(--light)" stroke-width="16"
        stroke-dasharray="${circ-dN} ${dN}" stroke-dashoffset="${circ/4-dN}" stroke-linecap="round"/>
      <text x="${cx}" y="${cy-4}" text-anchor="middle" font-family="Cormorant Garamond,serif" font-size="22" fill="var(--black)">${tot}</text>
      <text x="${cx}" y="${cy+14}" text-anchor="middle" font-size="9" fill="#999">clientes</text>
    </svg>
    <div class="dleg">
      <div class="dli"><div class="dldot" style="background:var(--black)"></div>Nuevos: ${nv}</div>
      <div class="dli"><div class="dldot" style="background:var(--light)"></div>Recurrentes: ${rc}</div>
    </div>`;

  const cData=MM.map((m,i)=>({m,count:clientes.filter(c=>c.fecha_ultima_visita&&new Date(c.fecha_ultima_visita).getMonth()===i&&c.es_nuevo).length}));
  const maxC=Math.max(...cData.map(d=>d.count),1);
  document.getElementById('clientChart').innerHTML=cData.map(d=>`
    <div class="bcol">
      <div class="bval">${d.count>0?d.count:''}</div>
      <div class="binn"><div class="bar bi" style="height:${Math.max((d.count/maxC)*100,d.count>0?3:0)}%;width:18px;"></div></div>
      <div class="blbl">${d.m}</div>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONTENIDO / KANBAN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function savePost() {
  const tit=document.getElementById('p_tit').value.trim();
  if(!tit){notify('A√±ade un t√≠tulo',true);return;}
  posts.push({
    id:Date.now(), titulo:tit,
    plataforma:document.getElementById('p_pla').value,
    tipo:document.getElementById('p_tip').value,
    descripcion:document.getElementById('p_dsc').value,
    estado:document.getElementById('p_est').value
  });
  persist();
  document.getElementById('p_tit').value=''; document.getElementById('p_dsc').value='';
  closeModal('mPost'); renderKanban(); notify('‚úì Idea guardada');
}
function movePost(id,ns) {
  const p=posts.find(p=>p.id===id); if(p){p.estado=ns; persist(); renderKanban(); notify('Post movido');}
}
function deletePost(id) {
  if(!confirm('¬øEliminar?')) return;
  posts=posts.filter(p=>p.id!==id); persist(); renderKanban(); notify('Eliminado');
}
function renderKanban() {
  const cols=['ideas','produccion','publicado'];
  const lbls={ideas:'üí° Idea',produccion:'üé¨ Prod.',publicado:'‚úÖ Pub.'};
  cols.forEach(col=>{
    const items=posts.filter(p=>p.estado===col);
    document.getElementById('cnt-'+col).textContent=items.length;
    const cont=document.getElementById('col-'+col);
    if(!items.length){cont.innerHTML=`<div style="text-align:center;padding:22px 8px;font-size:12px;color:var(--light)">Vac√≠o</div>`;return;}
    cont.innerHTML=items.map(p=>{
      const pc=p.plataforma?.includes('TikTok')&&p.plataforma?.includes('Instagram')?'tbo':p.plataforma?.includes('TikTok')?'ttt':'tig';
      return `<div class="kcard">
        <div style="display:flex;justify-content:space-between;align-items:flex-start">
          <div class="kct2">${p.titulo}</div>
          <button onclick="deletePost(${p.id})" style="background:none;border:none;cursor:pointer;color:#ccc;font-size:18px;line-height:1;flex-shrink:0;padding:0 2px">&times;</button>
        </div>
        <div class="kcm"><span class="ptag ${pc}">${p.plataforma}</span><span>${p.tipo}</span></div>
        ${p.descripcion?`<div style="font-size:12px;color:var(--gray);line-height:1.5;margin-bottom:6px">${p.descripcion.substring(0,70)}${p.descripcion.length>70?'‚Ä¶':''}</div>`:''}
        <div class="kact">${cols.filter(c=>c!==col).map(c=>`<button class="kmv" onclick="movePost(${p.id},'${c}')">${lbls[c]}</button>`).join('')}</div>
      </div>`;
    }).join('');
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER ALL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAll() {
  renderClients();
  renderAgenda();
  renderGastos();
  renderBalance();
  renderKanban();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
renderAll();
</script>
</body>
</html>
